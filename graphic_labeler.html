<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<style>

html,
body {
  height: 100%;
  margin: 0;
  overflow: hidden;
}

svg {
  position: absolute;
}

line{
  stroke:#414042;
  stroke-width:3px;
}

</style>
<body>
<script src="//d3js.org/d3.v3.min.js"></script>
<script>

var width = self.frameElement ? 960 : innerWidth,
    height = self.frameElement ? 500 : innerHeight;

var data = d3.range(6).map(function(){ 
  return {x:Math.random() * width, y:Math.random() * height }
});

// clone data to use for line generation
var data2 = data.slice();

var lines = d3.range(3).map(function(){
  return {p1:data2.pop(),p2:data2.pop()}
});

var color = d3.scale.category10();

var drag = d3.behavior.drag()
    .origin(function(d) { return {x: d.x, y: d.y}; })
    .on("drag", dragged);

var body = d3.select("body")
    .on("touchstart", nozoom)
    .on("touchmove", nozoom)
var svg = body
  .append("svg")
    .attr("width", width)
    .attr("height", height)

var lines = svg
  .selectAll("line")
    .data(lines)
  .enter().append("line")
    .attr("x1", function(d) { return d.p1.x})
    .attr("y1", function(d) { return d.p1.y})
    .attr("x2", function(d) { return d.p2.x})
    .attr("y2", function(d) { return d.p2.y})
    
var circles = svg
  .selectAll("circle")
    .data(data)
  .enter().append("circle")
    .attr("transform", function(d) { return "translate(" + d.x+","+d.y + ")"; })
    .attr("r", 32)
    .style("fill", function(d, i) { return color(i); })
    .on("click", clicked)
    .call(drag);

function clicked(d, i) {
  if (d3.event.defaultPrevented) return; // dragged

  d3.select(this).transition()
      .style("fill", "black")
      .attr("r", 64)
    .transition()
      .attr("r", 32)
      .style("fill", color(i));
}

function nozoom() {
  d3.event.preventDefault();
}

function dragged(d) {
  d.x = d3.event.x, d.y = d3.event.y;
  if (this.nextSibling) this.parentNode.appendChild(this);
  d3.select(this).attr("transform", "translate(" + d.x+","+d.y + ")");
  lines
    .attr("x1", function(d) { return d.p1.x})
    .attr("y1", function(d) { return d.p1.y})
    .attr("x2", function(d) { return d.p2.x})
    .attr("y2", function(d) { return d.p2.y});
}

</script>